<script>
    function changeCategory(e) {
        $.ajax({
            url: '/api/sub-categories?category_id=' + e.value,
            type: 'GET',
            success: function (result) {
                $("#sub_category").empty();
                for (var i = 0; i < result.rows.length; i++) {
                    var options;
                    options = "<option value=" + result.rows[i].id + ">" + result.rows[i].name + "</option>";
                    $("#sub_category").append(options)
                }
            },
            error: function (error) {
                console.log("Error", error);
            }
        });
    }
    function changeCountry(e) {
        $.ajax({
            url: '/api/states?country_id=' + e.value,
            type: 'GET',
            success: function (result) {
                $("#state").empty();
                for (var i = 0; i < result.rows.length; i++) {
                    var options;
                    options = "<option value=" + result.rows[i].id + ">" + result.rows[i].name + "</option>";
                    $("#state").append(options)
                }
            },
            error: function (error) {
                console.log("Error", error);
            }
        });
    }
    function changeMarketplace(e) {
        $.ajax({
            url: '/api/marketplace-types?marketplace_id=' + e.value,
            type: 'GET',
            success: function (result) {
                $("#type").empty();
                for (var i = 0; i < result.rows.length; i++) {
                    var options;
                    options = "<option value=" + result.rows[i].id + ">" + result.rows[i].name + "</option>";
                    $("#type").append(options)
                }
            },
            error: function (error) {
                console.log("Error", error);
            }
        });
    }
</script>
<script>
    $(document).ready(function () {

        $("#productForm").submit(function (e) {
             e.preventDefault();
           
            let input = $("#productForm :input").filter(function (index, element) {
                return $(element).val() != '';
            }).serialize();   

            var form = new FormData();
            form.append("file", $("#file")[0].files[0]);
            form.append("filename", "test")
            
            var obj={};

            $.ajax({
                type: 'POST',
                url: '/api/products/upload',
                data: form,
                cache: false,
                dataType: 'json',
                processData: false,
                contentType: false,
                success: function (data) {
                    obj.type = 1;
                    obj.status = 1;
                    obj.url = data.imageURL;
                    obj.base_image = 1;
                     $.ajax({
                        type: 'POST',
                        url: '/api/product/add-product?'+input,
                        data: obj,
                        success: function (data) {
                        },
                        error: function (error) {
                                    console.log('error', error);
                                }
                     })
                },
                    error: function (error) {
                    console.log('error', error);
                }
            });
        });
           
  /*  $.ajax({
                type: 'POST',
                url: '/api/products/upload',
                data: form,
                cache: false,
                dataType: 'json',
                processData: false,
                contentType: false,
                success: function (data) {
                    obj.type = 1;
                    obj.status = 1;
                    obj.url = data.imageURL;
                    $.ajax({
                        type: 'POST',
                        url: '/api/product-medias',
                        data: obj,
                        success: function (data) {
                            $.ajax({
                                type: 'POST',
                                url: '/api/products',
                                data: newProduct,
                                success: function (data) {
                                    console.log("data", data);
                                },
                                error: function (error) {
                                    console.log('error', error);
                                }
                            });
                        },
                        error: function (error) {
                            console.log('error', error);
                        }
                    });
                },
                error: function (error) {
                    console.log('error', error);
                }
            });*/

        
    });
</script> {{> header/defaultHeader LoggedInUser = LoggedInUser}} {{> vendor/header}}
<section class="showing_categ">
    <div class="">
        <div class="container">
            <div class="row">
                {{> vendor/navbar}}
                <div class="col-md-8" style="background-color: #fff;">
                    <form id="productForm">
                        <h5 style="padding-top: 20px;">Add Product</h5>
                        <div class="row">
                            <div class="col-md-12">
                                <input type="text" name="product_name" id="product_name" placeholder="Product Name" class="vend_edit_lists_textstyle" style="width:80%; margin:20px; padding:15px 10px"
                                    required />
                            </div>
                            <div class="col-md-12">
                                <select class="vend_edit_lists_dropdownstyle" id="marketplace" name="marketplace_id" onChange="changeMarketplace(this);" style="margin:20px; margin-top:0px; padding:15px 10px; width:25%">
                                    <option disabled selected>Select Marketplace</option>
                                    {{#each marketplace}}
                                    <option value="{{this.id}}">{{ this.name}}</option>
                                    {{/each}}
                                </select>
                                <select class="vend_edit_lists_dropdownstyle" name="marketplace_type_id" id="type" value="" style="margin:20px; margin-top:0px;margin-left:0px; padding:15px 10px; width:25%">
                                    <option disabled selected>Type</option>
                                </select>
                                <input type="text" name="moq" id="moq" placeholder="Minimum Order Quantity" class="vend_edit_lists_textstyle1" style="margin:20px; margin-top:0px; margin-left:0px; padding:15px 10px; width:24%"
                                />
                            </div>
                            <div class="col-md-12">
                                <select class="vend_edit_lists_dropdownstyle" id="category" name="product_category_id" style="margin:20px; margin-top:0px;padding:15px 10px; width:38.5%" onChange="changeCategory(this);">
                                    <option disabled selected>Category</option>
                                    {{#each category}}
                                    <option value="{{this.id}}">{{ this.name}}</option>
                                    {{/each}}
                                </select>
                                <select class="vend_edit_lists_dropdownstyle" name="sub_category_id" id="sub_category" value="" style="margin:20px; margin-top:0px;margin-left:0px; padding:15px 10px; width:38.5%">
                                    <option disabled selected>Sub Category</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <select class="vend_edit_lists_dropdownstyle" id="country" name="product_location" onChange="changeCountry(this);" style="margin:20px; margin-top:0px; padding:15px 10px; width:25%">
                                    <option disabled selected>Country</option>
                                    {{#each country}}
                                    <option value="{{this.id}}">{{ this.name}}</option>
                                    {{/each}}
                                </select>
                                <select class="vend_edit_lists_dropdownstyle" name="state_id" id="state" value="" style="margin:20px; margin-top:0px;margin-left:0px; padding:15px 10px; width:25%">
                                    <option disabled selected>State</option>
                                </select>
                                <input type="text" name="city" id="city" placeholder="City" class="vend_edit_lists_textstyle1" style="margin:20px; margin-top:0px; margin-left:0px; padding:15px 10px; width:24%"/>
                            </div>
                            <div class="col-md-12">
                                <input type="text" name="sku" id="sku" placeholder="SKU" class="vend_edit_lists_textstyle1" style="margin:20px; margin-top:0px; padding:15px 10px; width:25%"/>
                            
                                <input type="text" name="price" id="price" placeholder="Price" class="vend_edit_lists_textstyle1" style="margin:20px; margin-top:0px; margin-left:0px; padding:15px 10px; width:24%"/>
                          
                                <input type="text" name="quantity_available" id="quantity_available" placeholder="Quantity Available" class="vend_edit_lists_textstyle1" 
                                style="margin:20px; margin-top:0px; margin-left:0px; padding:15px 10px; width:25%"/>
                            </div>
                            <div class="col-md-12">
                                <div class="row">
                                <label>
                                    <h6 style="margin-left:30px;">Description</h6>
                                </label>
                                </div>
                                <div class="row">
                                <textarea id="description" name="description" class="vend_edit_lists_textstyle1" style="width:79%; margin:20px; margin-top:0px; margin-left:30px; padding:15px 10px"></textarea>
                            </div>
                            </div>
                            <div class="col-md-12">
                                <label>
                                    <h6 style="margin-left:20px;">Upload Image </h6>
                                </label>
                                <input type="file" class="vend_edit_lists_textstyle1" id="file" name="file" />
                            </div>
                        </div>
                        <hr/>
                        <div class="row">
                            <div class="col-md-12">
                                <input class="list_butt_1" type="Submit" id="productSubmitBtn" name="productSubmitBtn">
                                <input class="list_butt_2" type="reset" id="productCancelBtn" name="productCancelBtn">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <p class="vend_edit_lists_pstyle"></p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-2">
                </div>
            </div>
        </div>
    </div>
</section>
{{> footer/footer}}