<script>

	var cartItems = {{{ DisplayJSON cartItems }}};

	function removeGtcCart(item) {
		var result = confirm("Are you sure you want to delete this item?");
		if (result) {
			//Logic to delete the item
			$('#remove-cart-' + item).removeAttr('href');

			$.ajax({
				url: '/api/cart/remove-cart/' + item,
				type: 'DELETE',
				success: function (result) {
					if (result)
						location.reload();
				},
				error: function (error) {
					console.log("Error occured while deleting", error);
				}
			});
		}
	}

	function UpdateAllCartItems() {

		let allCartInfo = {};

		allCartInfo["cartUpdateArray"] = [];


		$(".all-quantity-cart-items").each(function () {
			for (var i = 0; i < cartItems.length; i++) {

				let uniqueId = "inputQty" + cartItems[i].id;
				console.log("uniqueId", uniqueId)
				let currentElementId = $(this).attr('id');
				console.log("currentElementId", currentElementId)

				if (uniqueId == currentElementId) {
					let temp = {};

					temp['product_quantity'] = $(this).val();
					temp['product_id'] = cartItems[i].product_id;
					temp['cart_item_id'] = cartItems[i].id

					allCartInfo['cartUpdateArray'].push(temp);
				}
			}
		});

		$.ajax({
			url: '/api/cart/update-cart',
			type: 'POST',
			data: JSON.stringify(allCartInfo),
			contentType: "application/json",
			success: function (updateAllData) {
				// window.location.reload();
				$('#gtc-cart-alert').prop('disabled', false);
				if (updateAllData.statusCode == 200) {
					$('#gtc-cart-alert').removeClass('alert-danger').addClass('alert-success');
					$('#gtc-cart-alert .cart-message').text(updateAllData.message_details);
					$("#gtc-cart-alert").fadeTo(2000, 500).slideUp(500, function () {
						$("#gtc-cart-alert").slideUp(500);
						location.reload();
					});
				} else {
					$('#gtc-cart-alert').removeClass('alert-success').addClass('alert-danger');
					$('#gtc-cart-alert .cart-message').text(updateAllData.message_details);
					$("#gtc-cart-alert").fadeTo(2000, 500).slideUp(500, function () {
						$("#gtc-cart-alert").slideUp(500);
					});
				}
			},
			error: function (error) {
				console.log("Error occured while updating", error);
				$('#quantity-cart-' + error['responseJSON']['cart_item_id']).notify(error.responseJSON.message_details, "error");
			}
		});
	}

	function UpdateGtcCart(productId, cartItemId, qtyItem, productName) {

		$('.cartAlert').html("");
		//console.log(item, qtyItem, cartItemId)
		console.log(productId, cartItemId, qtyItem)
		let cartInfo = {};
		cartInfo["cartUpdateArray"] = [];

		let cartItem = {};
		var testses = $('#inputQty' + cartItemId)[0].id;
		console.log(testses)
		console.log("test", $('#inputQty' + cartItemId)[0].id)
		cartItem['product_quantity'] = $('#inputQty' + cartItemId).val();
		cartItem['product_id'] = productId;
		cartItem['cart_item_id'] = cartItemId;
		console.log(cartItem)
		cartInfo['cartUpdateArray'].push(cartItem);
		console.log(cartInfo)
		if (cartItem.product_quantity < qtyItem) {
			console.log("dfgsg", cartItem.product_quantity)
			$('.cartAlert').html(productName + " Minimum quantity " + qtyItem);
			//$.notify(productName+" Minimum quantity "+qtyItem);

		} else {
			$.ajax({
				url: '/api/cart/update-cart',
				type: 'POST',
				data: JSON.stringify(cartInfo),
				contentType: "application/json",
				success: function (updateData) {

					//$('#quantity-cart-' + cartItemId).notify("Quantity Updated to " + cartItem.product_quantity, "success");

					$("#inputQty" + cartItemId).notify("Quantity Updated to " + cartItem.product_quantity, "success");

					setTimeout(function () {
						window.location.reload();
					}, 1500);
				},
				error: function (error) {
					console.log("Error occured while updating", error);
					//$('#quantity-cart-' + cartItemId).notify(error.responseJSON.message_details, "error");
					$("#inputQty" + cartItemId).notify(error.responseJSON.message_details, "error");
				}
			});
		}

	}


	function applyGTCCoupon() {
		var cartInfo = {};
		cartInfo.coupon_code = $("#coupon-input-code").val();
		if (!cartInfo.coupon_code) {
			alert('Please enter promo code to apply coupon code');
			return false;
		}
		$.ajax({
			url: '/api/cart/apply-coupon',
			type: 'POST',
			data: cartInfo,
			success: function (updateData) {
				console.log(updateData.message_details);
				// var data = updateData.message_details;
				$('#gtc-coupon-alert').prop('disabled', false);
				$('#gtc-coupon-alert').removeClass('alert-danger').addClass('alert-success');
				$('#gtc-coupon-alert .coupon-message').text(updateData.message_details);
				$("#gtc-coupon-alert").fadeTo(2000, 500).slideUp(500, function () {
					$("#gtc-coupon-alert").slideUp(500);
					// location.reload();
				});
			},
			error: function (error) {
				console.log("Error occured while updating", error);
			}
		});
	}

	function orderCheckout() {
		location.href = "/order-checkout/customer-information"
	}
	$(document).ready(function () {
		$('#gtc-coupon-alert').hide();
		$('#gtc-cart-alert').hide();
	});

</script>
<script src="js/login.js"></script> {{> header/top-header LoggedInUser = LoggedInUser}}
<div class="wrapper-content">
	<div class="container-sm">
		<div class="title-header-1 gtc-p-l-r">
			<div class="alignleft">
				<ul class="breadcrumb">
					<li>
						<a href="#" class="active">My Account</a>
					</li>
					<li>Shopping Cart</li>
				</ul>
			</div>
			<div class="alignright">
				{{#if LoggedInUser.id}}
				<span class="text-sm">You're logged in as </span>
				<a class="text-sm" href="javascript:;">{{LoggedInUser.first_name}}</a>
				<button type="button" class="btn btn-sm btn-primary">SWITCH ACCOUNT</button>
				{{else}}
				<span class="text-sm">
					<a href="/login">Login</a> to see seller information</span>
				{{/if}}
			</div>
			<div style="clear: both;"></div>
		</div>
		<div class="body-content-1">
			<div class="row no-margins">
				<div class="col-sm-9half no-padding header-left">
					<div class="header-lg gtc-p-l-r">
						<h2 class="header-lg-text alignleft">MY SHOPPING CART</h2>
						<span class="header-lg-span">({{cartItemsCount}} Item Totals)</span>
					</div>
				</div>
				<div class="col-sm-3half no-padding header-right">
					<div class="header-lg gtc-p-l-r">
						<h2 class="header-lg-text">YOUR ORDER</h2>
					</div>
				</div>
			</div>
			<div class="alert" id="gtc-cart-alert">
				<button type="button" class="close" data-dismiss="alert">
					<span aria-hidden="true">&times;</span>
				</button>
				<span class="cart-message"></span>
			</div>
			<span style="color:red;" class="cartAlert"></span>

			<div class="row no-margins">
				<div class="col-sm-9half no-padding">
					<div class="bg-white">
						{{#each marketPlaces as |marketPlace|}} {{#each ../seperatedItemsList}} {{#ifCond marketPlace.code '==' @key}}
						<div class="{{cartPageClass marketPlace 'CART-LEFT'}}">{{cartPageClass marketPlace 'LABEL'}} Items ({{this.length}})</div>
						{{/ifCond}} {{/each}}

						<div class="m-cart-body">
							<table class="table cart-inner-table m-b-none">
								{{#each ../seperatedItemsList}} {{#ifCond marketPlace.code '==' @key}} {{#ifCond @key.length '>' 0}}
								<thead>
									<tr>
										<th width="45%">Product</th>
										<th width="25%">Price</th>
										<th width="15%">QTY</th>
										<th width="15%" class="text-right">Total Price</th>
									</tr>
								</thead>
								{{/ifCond}} {{/ifCond}} {{/each}}
								<tbody>
									{{#each ../cartItems as |cartItem|}} {{#ifCond marketPlace.id '===' cartItem.Product.Marketplace.id }}
									<tr>
										<div class="pos-demo">

										</div>
										<td class="d-flex">
											<div class="col-4 product-left-col">
												<img class="object-fit" src="{{cartItem.Product.ProductMedia.[0].url}}" alt="T-Shirt with Logo" title="T-Shirt with Logo">
											</div>
											<div class="col-8">
												<div class="product-middle-col">
													<h3 class="m-cart-title">
														<a href="/products/{{cartItem.Product.product_slug}}/{{cartItem.Product.id}}" class="text-black">{{cartItem.Product.product_name}}</a>
													</h3>
													<div class="row no-margins">
														<div class="col-md-4 col-4 no-padding">
															<span>Origin</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<span class="text-500">{{cartItem.Product.State.name}}</span>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Category</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<a class="text-500" href="#" title="OTHERS > Others">{{cartItem.Product.Category.name}} > {{cartItem.Product.SubCategory.name}}</a>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Seller</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															{{#if ../../LoggedInUser.email}}
															<a class="text-500" title="{{cartItem.Product.Vendor.vendor_name}}" href="/vendor/{{cartItem.Product.Vendor.vendor_id}}">{{cartItem.Product.Vendor.vendor_name}}</a>
															{{else}}
															<a class="text-500" href="javascript:;" id="Seller_Info" title="seller">(Login for Seller Info)</a>
															{{/if}}
														</div>
													</div>
												</div>
											</div>
										</td>
										<td>
											<span class="price-tag d-block text-blue">${{cartItem.Product.price}}</span>
											{{#if cartItem.Product.moq}}
											<small class="m-qty">Minimum Order Quantity: {{cartItem.Product.moq}}</small>
											{{/if}}
										</td>
										<td>
											{{!-- id="update-cart-{{cartItem.id}}" --}}
											<input id="inputQty{{cartItem.id}}" type="number" placeholder="1" min="1" value={{cartItem.Product.moq}} class="all-quantity-cart-items"
											 style="width: 50px;">

											<a href="javascript:;" onclick="UpdateGtcCart(`{{cartItem.Product.id}}`,`{{cartItem.id}}`,`{{cartItem.Product.moq}}`,`{{cartItem.Product.product_name}}`)"
											 class="text-xs m-l-xs">
												<small>Update</small>
											</a>
										</td>
										<td class="text-right">
											<span class="price-tag m-b-xs d-block">${{quantityPrice cartItem.quantity cartItem.Product.price}}</span>
											<button type="button" id="remove-cart-{{cartItem.id}}" onclick="removeGtcCart(`{{cartItem.id}}`)" href="javascript:;" class="btn btn-sm btn-primary">REMOVE</button>
										</td>
									</tr>
									{{/ifCond}} {{/each}}
								</tbody>
							</table>
						</div>
						{{/each}}
					</div>
					{{#each marketPlaces as |marketPlace|}} {{#each ../seperatedItemsList}}
					{{#ifCond this.length ">=" 0}}
					<button class="btn btn-md btn-success m-t-sm" onclick="location.href = '/'">CONTINUE SHOPPING</button>
					<button class="btn btn-md btn-primary m-t-sm alignright" id="UpdateTalks" onclick="UpdateAllCartItems()">UPDATE CART</button>
					{{/ifCond}}
					{{#ifCond this.length "==" 0}}
					<p class="text-black">No Product Added Cart</p>
					{{/ifCond}}
					{{/each}}{{/each}}
					

				</div>

				<div class="col-sm-3half no-padding">
					<div class="cart-summary" style="padding-top:0px"  >
						{{#each marketPlaces as |marketplace|}} {{#each ../totalPriceList as |totalPrice|}} {{#ifCond marketplace.code '==' @key}}
						<h2 class="{{cartPageClass marketplace 'CART-RIGHT'}}">{{cartPageClass marketplace 'LABEL'}} Summary</h2>
						<div class="cart-hr-line"></div>
						<div class="total-content">
							<div class="alignleft">
								<span class="total-text">Subtotal</span>
							</div>
							<div class="alignright">
								<span class="total-value">{{currency totalPrice.price '$'}}</span>
							</div>
							<div style="clear: both;"></div>
							<div class="alignleft">
								<span class="total-text">Shipping Ground</span>
							</div>
							<div class="alignright">
								<span class="total-value">{{currency totalPrice.shipping '$'}}</span>
							</div>
							<div style="clear: both;"></div>
							<div class="cart-hr-line"></div>
							<div class="alignleft">
								<span class="total-text">
									<b>WHOLESALE TOTAL</b>
								</span>
							</div>
							<div class="alignright">
								<span class="total-value">{{currency totalPrice.total '$'}}</span>
							</div>
							<div style="clear: both;"></div>
						</div>
						{{/ifCond}} {{/each}} {{/each}}

						<div class="total-content">
							<div class="alignleft">
								<span class="total-text">
									<b>GRAND TOTAL</b>
								</span>
							</div>
							<div class="alignright">
								<span class="total-value">{{currency totalPriceList.grandTotal '$'}}</span>
							</div>
						</div>

						<div class="m-t-sm">
							<label class="m-b-xs">
								<strong class="text-black">Have A Promo Code?</strong> Enter it here</label>
							<input type="text" class="promo-text-control">
						</div>
						<div class="text-center">
							<button class="btn btn-md btn-primary m-t-sm m-b-sm btn-block" style="background: #e62345;">CHECKOUT NOW</button>
							<img src="../img/payment-methods.jpg" class="img-fluid w-75">
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
{{> footer/bottom-footer}}