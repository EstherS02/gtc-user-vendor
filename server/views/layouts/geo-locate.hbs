 
 {{> header/top-header LoggedInUser = LoggedInUser}}
<section class="constant-height" style="height: 650px;">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-3 constant-height" style="height: 650px;overflow-y: scroll;">
				<div class="row" style="margin-bottom:20px;">
					<div class="col-md-2 geo_arrow_bg">
						<a href="geolocate_search.html" style="color: #fff;"><i class="fas fa-caret-left"></i></a>
					</div>
					<div class="col-md-10 geo_sort_bg">
						Sort by 
						<select class="acc_textbox"> <option value="Alphabetical">Alphabetical </option></select>
					</div>
				</div>
                {{#each geoLocateObj}}
					<div class="row" >
                      <div class="col-md-3 col-2" style="text-align: center;">
                          <img src="{{this.product_media_base_image}}" style="width: 75px; height: 70px;">
                      </div>
                      <div class="col-md-9 col-10">
                          <div class="row common_padding">
                              <div class="col-md-8 col-8">
                                  <p class="wts_header"><a href="#" style="font-size: 12px;">{{this.product_name}}</a></p>
                              </div>
                              <div class="col-md-4 col-4" style="display:none;">
                                  <p>MOQ: 40</p>
                              </div>
                          </div>
                          <div class="row common_padding">
                              <div class="col-md-3 col-3">
                                  <p>Origin</p>
                              </div>
                              <div class="col-md-5 col-6">
                                  <p>{{this.country_name}}</p>
                              </div>
                              <div class="col-md-4 col-3">
                                  <p>&nbsp;</p>
                              </div>
                          </div>
                          <div class="row common_padding">
                              <div class="col-md-3 col-3">
                                  <p>Category</p>
                              </div>
                              <div class="col-md-5 col-6">
                                  <p>{{this.category_name}} - {{this.sub_category_name}}</p>
                              </div>
                              <div class="col-md-4 col-3">
                                  <p>Seller Rating</p>
                              </div>
                          </div>
                          <div class="row common_padding">
                              <div class="col-md-3 col-3">
                                  <p>Seller</p>
                              </div>
                            <div class="col-md-5 col-6 overflow-txt">
                                {{#if ../LoggedInUser.email}}
                                    <a title="{{this.vendor_name}}" href="/vendor/{{this.vendor_id}}" style="font-size:11px;">{{this.vendor_name}}</a>
                                {{else}}
                                    <a href="/login" style="font-size:9px;">(Login for Seller Info)</a>
                                {{/if}}
                            </div>
                              <div class="col-md-4 col-3">
                                  <p style="font-size: 7px;">
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                    <i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
                                  </p>
                              </div>
                          </div>
                      </div>
                  </div>
                  <hr/>
                {{/each}}
				  <div class="row">
                    <div class="col-md-12" style="background-color: #F0F0F0;">
                       <p class="geo_show">Showing <span class="geo_pro"> 1660 products </span></p>
                       <p class="geo_adv">Advanced Search / Filter</p> 
                    </div>
                    </div>
			</div>
			<div class="col-md-9 common_padding1">
						<div id="map" style=""></div>
						<div id="bus_station" class="panel-collapse collapse"></div>
			</div>
		</div>
	</div>
</section>
{{> footer/bottom-footer}}


 <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDep_3sNz9G0wPjKYWvnQV-h-zuX427yI0&libraries=places"></script>

<script>

    function getCookie(c_name) {
        return localStorage.getItem(c_name);
    }

    function setCookie(c_name, value) {
        return localStorage.setItem(c_name, JSON.stringify(value));
    }


    var userLocation = {}, infowindow, map, marker, formattedLocation;
    var vendorGroupedObj = {{{DisplayJSON geoLocateByVendor}}}
    var mapObjVendor = Object.keys(vendorGroupedObj)

     function initMap(geoUserLat, geoUserLng){
            formattedLocation = new google.maps.LatLng(geoUserLat, geoUserLng);

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: formattedLocation
            });

            for(let i=0; i< mapObjVendor.length; i++){
                let mapObjProduct = vendorGroupedObj[mapObjVendor[i]];
                var content = `<p><img src="`+ mapObjProduct[0].vendor_profile_pic_url +`" style="width: 50px; height: 50px;">
                <span style="font-size: 12px;">`+mapObjProduct[0].vendor_name+`</span>
                <span class="text_blue_color" style="font-size: 8px;left: 49px;position: absolute;top: 32px;font-weight: bold;">2002 Product Listed</span>
                <span class="text_blue_color" style="font-size: 8px;left: 49px;position: absolute;top: 40px;">Online Payments</span>
                </p>`;
                let more_content = "";
                for(let j=0; j< mapObjProduct.length; j++){
                    if(j === 3){
                        break;
                    }
                    more_content = more_content + `<a href="#"><img src="`+ mapObjProduct[j].product_media_base_image +`" style="width: 40px; height: 30px;"></a>`;
                }
                content = content + `<p>`+ more_content + `<a href="#">See All</a></p>`;
                createMarker(mapObjProduct[0].latitude, mapObjProduct[0].longitude, content);
            }

        }

        function createMarker(lat, lon, content){

            var markerLocation = new google.maps.LatLng(lat, lon);

            infowindow = new google.maps.InfoWindow({
                content: content,
                maxWidth: 200
            });

            /*
              icon: {
                    url: 'https://i.imgur.com/MjI0xAW.png'
                }
            */

            marker = new google.maps.Marker({
                position: markerLocation,
                map: map,
                title: 'Vendor Details'
                
            });

            //let more_content = '<span target="details">'+lat +','+ lon +'</span>';

            google.maps.event.addListener(marker, 'mouseover', function () {
                infowindow.setContent(content);
                infowindow.open(map, this);
            });

            google.maps.event.addListener(map, "click", function(event) {
                infowindow.close();
            });

        }

         /* google.maps.event.addDomListener(window, 'load', function () {
            initMap(13.0723623, 80.20335009999997);
         }); */

    if (navigator.geolocation) {
            function geoLocationSuccess(position) {
                geoUserLng = position.coords.longitude;
                geoUserLat = position.coords.latitude;
    
                userLocation.location = {
                    geoUserLng: geoUserLng,
                    geoUserLat: geoUserLat
                };
                
                console.log("userLocation", userLocation)

                setCookie("userLocation", userLocation.location);
                
                initMap(geoUserLat, geoUserLng);
            }

            function geoLocationError(error) {
                // Default location
                userLocation.location = {
                    lng: -100.655093,
                    lat: 41.3884206
                };
                    
                console.log('Location access denied' + error.code);
                console.log("Default ", userLocation);
            }

            var geoOptions = {
              enableHighAccuracy: true,
              maximumAge: 0
            };


            let getCookieItem = JSON.parse(getCookie("userLocation"));
                console.log("getCookieItem", getCookieItem)
            if(getCookieItem){
                console.log("Reusing Location");
                initMap(getCookieItem.geoUserLat, getCookieItem.geoUserLng)
            }else{
                console.log("Fetching New location");
                navigator.geolocation.getCurrentPosition(geoLocationSuccess, geoLocationError, geoOptions);
            }

        } else {
            callback(userLocation);
            console.log("Cannot determine user location");
        }
    
    </script>

