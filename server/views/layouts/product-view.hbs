<style>
	#addCompare {
		cursor: pointer;
	}
</style>

<script>

	var userInfo = {{{ DisplayJSON LoggedInUser }}}
	var productSpecs = {{{DisplayJSON product}}}
	var statusCode = {{{DisplayJSON status}}}

	$(function() {
		$('#review-stars').barrating({
			theme: 'fontawesome-stars'
		});

		$("#gtc-cart-alert").hide();
		$("#gtc-add-to-cart").click(function() {
			$('#gtc-add-to-cart').prop('disabled', true);

			var cartInfo = {};
			cartInfo.product_quantity = $('#quantityInput').val();

			$.ajax({
				type: "POST",
				url: "/api/cart/add-cart/" + productSpecs.id,
				data: cartInfo,
				success: function(res) {
					$('#gtc-add-to-cart').prop('disabled', false);
					if (res && res.message === "SUCCESS") {
						outputPop(res.message_details);
						// $('#gtc-cart-alert').removeClass('alert-danger').addClass('alert-success');
						// $('#gtc-cart-alert .cart-message').text(res.message_details)
						// $("#gtc-cart-alert").fadeTo(7000, 500).slideUp(500, function() {
						// 	$("#gtc-cart-alert").slideUp(500);
						// 	location.reload();
						// });
						console.log(res)
					}
				},
				error: function(error) {
					$('#gtc-add-to-cart').prop('disabled', false);
					if (error) {
						if (error.status === 401)
							return location.href = "/login";

						outputErrorPop(error);
						// $('#gtc-cart-alert').removeClass('alert-success').addClass('alert-danger');
						// $('#gtc-cart-alert .cart-message').text(error.responseJSON.message + " : " + error.responseJSON.message_details)
						// $("#gtc-cart-alert").fadeTo(7000, 500).slideUp(500, function() {
						// 	$("#gtc-cart-alert").slideUp(500);
						// });

					}
				}
			});
		});
	});


	$("#reviewForm").validate({
		rules: {
			reviewDetailComment: "required",
			reviewTitle: "required"
		},
		messages: {
			reviewDetailComment: "Please Enter your review Comment",
			reviewTitle: "Please enter your Review title"
		}
	});

	function reviewSubmit(id) {

		let reviewObj = {};

		if (userInfo.email) {
			if ($("#reviewForm").valid()) {
				reviewObj['rating'] = $('#review-stars').val();
				reviewObj['title'] = $('#review-title').val();
				reviewObj['comment'] = $('#review-detail-comment').val();
				reviewObj['product_id'] = parseInt(id);
				reviewObj['user_id'] = parseInt(userInfo.id);
				reviewObj['status'] = 1;

				console.log(reviewObj);

				$.ajax({
					type: "POST",
					url: "/api/reviews",
					data: reviewObj,
					success: function(result) {
						if (result)
							location.reload();
					}
				});
			}
		} else {
			location.href = "/login"
		}
	}

	function wishUpdate() {
		if (userInfo.email) {
			var newObj = {};
			newObj.product_id = productSpecs.id;
			newObj.user_id = userInfo.id;
			if ($('input[name=wishID]').val()) {
				newObj.status = 0;
			} else {
				newObj.status = statusCode.ACTIVE;
			}
			console.log(newObj);
			var queryObj = {};
			queryObj.product_id = productSpecs.id;
			queryObj.user_id = userInfo.id;
			var data = JSON.stringify({
				queryObj: queryObj,
				newObj: newObj
			});
			var newData = {};
			newData.data = data;
			$.ajax({
				type: 'PUT',
				url: '/api/product-view/addOrRemove',
				data: newData,
				success: function(data, text) {
					location.reload();
				},
				error: function(request, status, error) {
					console.log('status', status);
					console.log('error', error);
				}
			});

		} else {
			location.href = "/login"
		}

	}

</script>
<script type="text/javascript">
var productSpecs = {{{DisplayJSON product}}}
var newData = {};
newData.product_id = productSpecs.id;
function compareProduct(e){
	$.ajax({
		type: 'POST',
		url: '/api/product-view/add-to-compare',
		data: newData,
		success: function(res) {
			if (res && res.message === "SUCCESS") {
                    outputPop(res.message_details);
                    console.log(res)
                }
		},
		error: function(error) {
			if (error) {
                    if (error.status === 401)
                        return location.href = "/login";
                    outputErrorPop(error);
                }
			console.log('error', error);
		}
	});

}
 function outputPop(argument) {
        $('#gtc-cart-alert').removeClass('alert-danger').addClass('alert-success');
        $('#gtc-cart-alert .cart-message').text(argument)
        $("#gtc-cart-alert").fadeTo(5000, 500).slideUp(500, function() {
            $("#gtc-cart-alert").slideUp(500);
            location.reload();
        });
    }

    function outputErrorPop(argument) {
        $('#gtc-cart-alert').removeClass('alert-success').addClass('alert-danger');
        $('#gtc-cart-alert .cart-message').text(argument.responseJSON.message + " : " + argument.responseJSON.message_details)
        $("#gtc-cart-alert").fadeTo(7000, 500).slideUp(500, function() {
            $("#gtc-cart-alert").slideUp(500);
        });
    }
</script>

{{> header/top-header LoggedInUser = LoggedInUser}}
{{> vendor/vendor-header VendorDetail = VendorDetail}}

<div class="bg-gray">
	<div class="gtc-container">
		<div class="row">
			<div class="v-col-2 col-12 m-t-sm">
				{{> vendor/vendor-left VendorDetail = VendorDetail}}
			</div>
			<div class="v-col-10 col-12 m-t-sm"> 
				<div class="header-lg bg{{product.Marketplace.id}}">
					<h2 class="header-lg-text">{{product.Marketplace.name}}</h2>
				</div>
				<div class="row no-margins">
					<div class="col-md-9 no-padding">
						<div class="ibox">
                            <div class="ibox-content">
                            	<div class="row">
                            		<div class="col-md-4">
                            			<img src="{{product.ProductMedia.[0].url}}" class="m-b-sm img-fluid" alt="product image">
										<div class="row">
											{{#each product.ProductMedia}}
											{{#if @first}} 
											{{else}} 
											{{#ifCond @index '<' 4}}
											<div class="col-md-4 col-4">
												<img src="{{this.url}}" class="img-fluid" alt="product image">
											</div>
											{{/ifCond}}
											{{/if}}
											{{/each}}
										</div>
                            		</div>
                            		<div class="col-md-8">
                            			<div class="product-desc">
                            				<div class="row no-margins">
                            					<div class="col-md-5 no-padding">
                            						<div class="product-attr">
			                            				<div class="d-flex">
			                            					<div class="col-4 no-padding">
			                            						<span>Origin</span>
			                            					</div>
			                            					<div class="col-8 no-padding">
			                            						<span>{{product.Country.name}}</span>
			                            					</div>
			                            				</div>
			                            				<div class="d-flex">
			                            					<div class="col-4 no-padding">
			                            						<span>Category</span>
			                            					</div>
			                            					<div class="col-8 no-padding">
			                            						<span>{{product.Category.name}} > {{product.SubCategory.name}}</span>
			                            					</div>
			                            				</div>
			                            				<div class="d-flex">
			                            					<div class="col-4 no-padding">
			                            						<span>SKU</span>
			                            					</div>
			                            					<div class="col-8 no-padding">
			                            						<span>{{product.sku}}</span>
			                            					</div>
			                            				</div>
			                            				{{#ifCond product.marketplace_id '==' 1}}
			                            				<div class="d-flex">
			                            					<div class="col-4 no-padding">
			                            						<span>MOQ</span>
			                            					</div>
			                            					<div class="col-8 no-padding">
			                            						<span>{{product.moq}}</span>
			                            					</div>
			                            				</div>
			                            				{{/ifCond}}
			                            				<div class="d-flex">
			                            					<div class="col-4 no-padding">
			                            						<span>Availability</span>
			                            					</div>
			                            					<div class="col-8 no-padding">
			                            						<span><strong>{{product.quantity_available}}</strong> in stock</span>
			                            					</div>
			                            				</div>
			                            			</div>
                            					</div>
                            					<div class="col-md-7 no-padding">
                            						<div class="add-to-bag text-right">
                            							<label class="m-r-xs text-light-muted">Quantity: </label>
                            							<input id="quantityInput" type="number" onkeypress="return event.charCode >= 48 && event.charCode <= 57" placeholder="1" value="1" min="1">
														<a href="javascript:;" class="btn btn-primary">
															<svg width="18" height="16" viewBox="0 0 21.4 20.8"><g fill="none" stroke="currentColor" stroke-width="2" stroke-miterlimit="10"><path d="M18.2 7.7h-15l-2 12.1h19z"/><path d="M14 12.4V4.3C14 2.5 12.5 1 10.7 1S7.3 2.5 7.3 4.3v8.1"/></g></svg>
															<span class="m-l-xs align-middle">ADD TO BAG</span>
														</a>
                            						</div>
                            					</div>
                            				</div>
                            			</div>
                            			<h1 class="p-title m-t-sm">{{product.product_name}}</h1>
                            			<h1 class="p-rate"><span class="p-symbol">$</span>{{product.price}}</h1>
                            			<p class="discount-text text-muted m-t-sm m-b-sm">This product has discounts on bulk orders.</p>
                            			<div class="p-social-compare">
                            				<div class="alignleft icon">
                            					<ul>
                            						<li>
                            							<a href="javascript:;" onclick="compareProduct()" id="addCompare">
															<svg xmlns="http://www.w3.org/2000/svg" width="22" height="19.3" viewBox="0 0 22 19.3"><path fill="none" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" d="M8.7 5.8L21 1.4v8.8zM13.3 13.5L1 17.9V9.2z"></path></svg>
															<span>Add to Compare</span>
														</a>
                            						</li>
                            						<li>
                            							<a href="javascript:;" onclick="wishUpdate()">
                            								{{#if wishList}}
                            								<svg xmlns="http://www.w3.org/2000/svg" width="19.8" height="18.6" viewBox="0 0 19.8 18.6"><path fill="currentColor" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" d="M9.9 3c.6-.8 1.4-1.3 2.3-1.7 2.8-1 6 .8 6.5 3.8.3 1.8-.2 3.3-1.4 4.6-2.4 2.4-4.8 4.9-7.1 7.3l-.2.2c-.1-.1-.1-.1-.2-.1-2.4-2.5-4.9-5-7.3-7.5C1.1 8.1.7 6.4 1.3 4.5c.6-1.9 2-3.1 3.9-3.4 1.8-.3 3.4.3 4.6 1.8 0 0 .1 0 .1.1z"></path></svg>
															<span>Added Wishlist</span>
                            								{{else}}
                            								<svg xmlns="http://www.w3.org/2000/svg" width="19.8" height="18.6" viewBox="0 0 19.8 18.6"><path fill="none" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" d="M9.9 3c.6-.8 1.4-1.3 2.3-1.7 2.8-1 6 .8 6.5 3.8.3 1.8-.2 3.3-1.4 4.6-2.4 2.4-4.8 4.9-7.1 7.3l-.2.2c-.1-.1-.1-.1-.2-.1-2.4-2.5-4.9-5-7.3-7.5C1.1 8.1.7 6.4 1.3 4.5c.6-1.9 2-3.1 3.9-3.4 1.8-.3 3.4.3 4.6 1.8 0 0 .1 0 .1.1z"></path></svg>
															<span>Add to Wishlist</span>
                            								{{/if}}
														</a>
                            						</li>
                            					</ul>
                            				</div>
                            				<div class="alignright text-right">
                            					<a href="javascript:;">
                            						<img src="../../gtc-assets/img/social-icons/linked-in.png" style="width: 15%;" alt="Linkedin" title="Linkedin">
                            					</a>
                            					<a href="javascript:;">
                            						<img src="../../gtc-assets/img/social-icons/pintrest.png" style="width: 15%;" alt="Pintrest" title="Pintrest">
                            					</a>
                            					<a href="javascript:;">
                            						<img src="../../gtc-assets/img/social-icons/twitter.png" style="width: 15%;" alt="Twitter" title="Twitter">
                            					</a>
												<a href="javascript:;">
													<img src="../../gtc-assets/img/social-icons/plus.png" style="width: 15%;" alt="Plus" title="Plus">
												</a>
                            				</div>
                            				<div style="clear: both;"></div>
                            			</div>
                            			<div class="p-description">
                            				<p class="text-muted">{{product.description}}</p>
                            			</div>
                            			<div class="p-hr"></div>
                            			<div class="product-rating d-flex m-t-sm m-b-sm">
											<div>
												<i class="fa fa-star fa-circle-bg"></i>
											</div>
											<div class="m-l-sm block-1">
												<h3 class="d-inline-block">Product Rating</h3>
												<h3 class="d-inline-block m-r m-l text-primary"><b>{{avgRating}}</b></h3>
												<h3 class="d-inline-block"><span class="text-black text-sm">Based on</span> <strong>23 Reviews</strong></h3>
												<div class="row">
													<div class="col-md-5 rating-content">
														{{#each rating}}
														<div class="d-flex">
															<div class="col-7 no-padding">
																<div class="7star p-rating">
																	{{starCount this.starCount}}
																</div>
															</div>
															<div class="col-5 no-padding">
																<span class="tot-rating-count">(<a href="javascript:;">{{this.ratingCount}} Ratings</a>)</span>
															</div>
														</div>
														{{/each}}
														<button type="button" class="btn btn-primary m-t-xs btn-block rounded btn-sm">Submit Your Own Review</button>
													</div>
													<div class="col-md-7 reviews-content">
														<div class="feed-activity-list">
															<div class="feed-element b-b-none">
																<a class="float-left" href="profile.html">
																	<img alt="image" class="rounded-circle" src="../../gtc-assets/images/a4.jpg">
																</a>
																<div class="media-body">
																	<span class="review-title">"Great place, great food, warm hospitality"</span>
																	<div class="m-b-xs m-t-xs">
																		<div class="alignleft">
																			<div class="p-rating">
																				<i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #CDBE29;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #b9bab1;"></i>
																				<i class="fa fa-star" aria-hidden="true" style="color: #b9bab1;"></i>
																			</div>
																		</div>
																		<div class="alignleft m-l-sm">
																			<small class="float-right">3 days ago</small>
																		</div>
																		<div style="clear: both;"></div>
																	</div>
																	<span>We had a conference planned and a snow storm threatened to cancel everything. Prince George staff helped us pull it off, with grace, professionalism and not a blip on anyone`s radar. By the end of the conference most of ourattendees had arrived after all and had a fabulous time, Well done folks!</span>
																</div>
															</div>
														</div>
														<button type="button" class="btn btn-success alignright m-t-xs rounded btn-sm">See All Reviews</button>
													</div>
												</div>
											</div>
										</div>
										<div class="p-hr"></div>
										<div class="ask-vendor d-flex m-t-sm">
											<div>
												<i class="fa fa-question-circle fa-circle-bg"></i>
											</div>
											<div class="m-l-sm block-2">
												<h3 class="m-b-xs">Ask the Vendor</h3>
												<p class="text-light-muted">If you`d like to ask the vendor a specific question about this product, please fill out following. It will be sent directly to the vendor.</p>
												<div class="ask-vendor-form">
													<form class="form" id="AskVendorForm">
														<div class="row">
															<div class="col-md-10">
																<div class="form-group">
																	<input type="text" class="form-control form-control-sm" placeholder="Subject">
																</div>
																<div class="form-group">
																	<textarea class="form-control form-control-sm" rows="3" placeholder="Tell us about you support issue with this product..."></textarea>
																</div>
															</div>
															<div class="col-md-2">
																<button type="submit" class="btn rounded btn-sm btn-bottom btn-success">Submit</button>
															</div>
														</div>
													</form>
												</div>
											</div>
										</div>
                            		</div>
                            	</div>
                            </div>
                        </div>
					</div>
					<div class="col-md-3 no-padding">
						{{> vendor/vendor-category }}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{{> footer/bottom-footer}}