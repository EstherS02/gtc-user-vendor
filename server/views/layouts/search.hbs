<script type="text/javascript">
function updateQueryStringParameter(uri, key, value) {
	var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
	var separator = uri.indexOf('?') !== -1 ? "&" : "?";
	if (uri.match(re)) {
		return uri.replace(re, '$1' + key + "=" + value + '$2');
	} else {
		return uri + separator + key + "=" + value;
	}
}

function appendLocation(location) {
	var url = window.location.href;
	var uri = updateQueryStringParameter(url, 'location', location);
	// var arr = url.split("&location")[0];
	// console.log("arr", arr);
	// var newQuery = arr + "&location=" + location;
	// window.location.href = window.location.origin + "/search" + newQuery;

}

function global() {
	var url = window.location.search;
	var arr = url.split("&location")[0];
	var newQuery = arr;
	window.location.href = window.location.origin + "/search" + newQuery;
}

function globalSearch() {
	window.location.href = window.location.origin + "/search";
}

function sortSearch(e) {
	var url = window.location.href;
	var order;
	if(e.value == 'product_name')
	{
	order = 'asc'; 
	}else{
	order = 'desc'; 
	}
	var uri = updateQueryStringParameter(url, 'field', e.value);
	uri = updateQueryStringParameter(uri, 'order', order)
	window.location.href = uri;
}

function getPage(marketplaceURl, selectedMarketPlaceType) {
	console.log(marketplaceURl);
	console.log(selectedMarketPlaceType);
}

function redirectBack() {
	var url = window.location.href;
	var key = 'is_featured_product';
	location.href = url.replace(new RegExp(key + "=\\w+"), "").replace("?&", "?").replace("&&", "&").replace("& ", "");
}
</script>
{{> header/top-header LoggedInUser = LoggedInUser}}
<div class="gtc-container">
	<div class="search-list-header">
		<div class="top-search-sm-header">
			<div class="alignleft">
				<ul class="breadcrumb">
					<li>
						<a href="{{marketplaceURl}}/search" class="active">{{#if queryURI.location}}{{Location queryURI.location locations.rows}}{{else}}Global{{/if}}</a>
					</li>
					<li>
						<a href="/{{marketplaceURl}}/search" class="active">{{Titlecase marketplaceURl}}</a>
					</li>
					{{#if queryURI.category}}
					<li>
						<a href="javascript:;" class="active">{{searchCategory categoriesWithCount.rows queryURI.category}}</a>
					</li>
					{{#if queryURI.sub_category}}
					<li>
					<a href="javascript:;" class="active">{{searchSubCategory categoriesWithCount.rows queryURI.sub_category queryURI.category}}</a>
					</li>
					{{/if}}
					{{/if}}
					
					<li>Search</li>
				</ul>
			</div>
			<div class="alignright">
				<div class="icon-post-ad">
					{{#if LoggedInUser.Vendor}}
					<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
						<circle fill="#E44766" cx="12" cy="12" r="12"></circle>
						<path fill="#FFF" d="M12 0l2.7 8.3h8.7l-7 5.1 2.7 8.3-7.1-5.1-7.1 5.1 2.7-8.3-7-5.1h8.7z"></path>
					</svg>
					<a href="/promote-store">
						<span>POST AN AD IN THIS CATEGORY</span>
					</a>
					{{/if}}
				</div>
			</div>
			<div style="clear: both;"></div>
		</div>
		<div class="row m-t-sm">
			<div class="col-md-8">
			
				<h3>{{#if products.count}} Showing  <b>{{SUMFloat queryPaginationObj.offset 1}}-{{#ifCond products.count '<' queryPaginationObj.limit}} {{products.count}} {{else}} {{SUMFloat queryPaginationObj.limit queryPaginationObj.offset}} {{/ifCond}}</b> of {{/if}}<b>{{products.count}} Products</b> matching {{#if queryPaginationObj.keyword}} <b>"{{queryPaginationObj.keyword}}"</b> {{/if}} <strong>{{#if queryURI.category}}"{{searchCategory categoriesWithCount.rows queryURI.category}}"{{/if}}</strong> {{#if selectedMarketPlace}}in the <b>{{selectedMarketPlace.name}}</b>{{/if}}</h3>
			</div>
			<div class="col-md-2">
				<div class="alignright">
					<label class="label-control m-r-md">View</label>
					<button type="submit" onclick="location.href = '../{{marketplaceURl}}/search?{{QueryParams queryURI (FrameObject layout='grid') 'null'}}'" class="btn btn-sm {{#ifCond queryURI.layout "==" 'grid'}}rounded {{/ifCond}} {{#ifCond queryURI.layout "==" 'list'}} btn-white{{/ifCond}}">
						<i class="fa fa-th-large"></i>
					</button>
					<button type="submit" onclick="location.href = '../{{marketplaceURl}}/search?{{QueryParams queryURI (FrameObject layout='list') 'null'}}'" class="btn btn-sm {{#ifCond queryURI.layout "==" 'list'}}rounded {{/ifCond}} {{#ifCond queryURI.layout "==" 'grid'}} btn-white{{/ifCond}}">
						<i class="fa fa-th-list"></i>
					</button>
				</div>
			</div>
			<div class="col-md-2">
				<form class="form-inline alignright">
					<div class="form-group">
						<label class="label-control m-r-md">Sort by</label>
						<div class="select-container">
							<select name="order" onchange="sortSearch(this)" class="form-control-customized rounded form-control-sm form-control-border" id="sortValue">
								<option disabled="true" selected="true">Sort by</option>
								<option value="product_name" {{#ifCond queryURI.field "==" 'product_name'}} selected="true" {{/ifCond}}>Alphabetical</option>
								<option value="created_on" {{#ifCond queryURI.field "==" "created_on"}} selected="true" {{/ifCond}}>Date</option>
							</select>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="row m-b-sm">
		<div class="col-md-3 search-list-left">
			<h5 class="right-header-sm" style="margin-top:10px">FILTER BY CATEGORY</h5>
			<p class="right-header-xs bg{{queryURI.marketplace}}">ALL CATEGORIES ({{categoriesWithCount.count}})</p>
			<ul class="right-list-view category-fixed">
				{{#each categoriesWithCount.rows}}
				<li>
					<a data-toggle="collapse" role="button" aria-expanded="true" aria-controls="listAGRICULTURE" class="{{#ifCond ../queryURI.category "!=" this.id}} collapsed {{/ifCond}}coll" href="#list{{this.name}}"></a><a href="../{{../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=1 category=this.id) 'null'}}">{{this.name}} ({{this.product_count}})</a>
					<ul class="inner-list-view collapse {{#ifCond ../queryURI.category '==' this.id}}show{{/ifCond}}" id="list{{this.name}}">
						{{#each this.SubCategories}}
						<li>
							<a {{#ifCond ../../queryURI.sub_category "==" this.id}} class="active" {{/ifCond}} href="../{{../../marketplaceURl}}/search?{{QueryParams ../../queryURI (FrameObject page=1 category=../this.id sub_category=this.id) 'null'}}">
								<span>{{this.name}}</span>
							</a>
						</li>
						{{/each}}
					</ul>
				</li>
				{{/each}}
			</ul>

			{{#ifCond marketplaceURl "==" "wholesale"}}
			<h5 class="right-header-sm" style="margin-top:10px">FILTER BY TYPE</h5>
			<p class="right-header-xs bg{{queryURI.marketplace}}">ALL TYPES ({{marketPlaceTypes.count}})</p>
			<ul class="right-list-view">
				{{#each marketPlaceTypes.rows}}
				<li>
					<a {{#ifCond ../queryURI.marketplace_type "==" this.id}} class="active" {{/ifCond}} href="../{{../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=1 marketplace_type=this.id) 'null'}}">
						<span>{{this.code}} - {{this.name}} ({{this.product_count}})</span>
					</a>
				</li>
				{{/each}}
			</ul>
			{{else ifCond marketplaceURl "==" "products"}}
			<h5 class="right-header-sm" style="margin-top:10px">FILTER BY TYPE</h5>
			<p class="right-header-xs bg{{queryURI.marketplace}}">ALL TYPES ({{marketPlaceTypes.count}})</p>
			<ul class="right-list-view">
				{{#each marketPlaceTypes.rows}}
				<li>
					<a {{#ifCond ../queryURI.marketplace_type "==" this.id}} class="active" {{/ifCond}} href="../{{../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=1 marketplace_type=this.id) 'null'}}">
						<span>{{this.code}} - {{this.name}} ({{this.product_count}})</span>
					</a>
				</li>
				{{/each}}
			</ul>
			{{/ifCond}}

			{{#ifCond marketplaceURl "!=" "lifestyle"}}
			<h5 class="right-header-sm" style="margin-top:10px">FILTER BY LOCATION</h5>
			<p class="right-header-xs bg{{queryURI.marketplace}}">GLOBAL ({{locations.count}})</p>
			<ul class="right-list-view category-fixed">
				{{#each locations.rows}}
				<li>
					<a {{#ifCond ../queryURI.location "==" this.id}} class="active" {{/ifCond}} href="../{{../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=1 location=this.id) 'null'}}">
						<span>{{this.name}} ({{this.product_count}})</span>
					</a>
				</li>
				{{/each}}
			</ul>
			{{/ifCond}}

			{{#ifCond marketplaceURl "==" 'lifestyle'}}
			<h5 class="right-header-sm" style="margin-top:10px">FILTER BY DURATION</h5>
			<p class="right-header-xs bg{{queryURI.marketplace}}">ALL TYPES ({{products.count}})</p>
			<ul class="right-list-view category-fixed">
				{{#each durations}}
				<li>
					<a data-toggle="collapse" role="button" aria-expanded="true" aria-controls="listAGRICULTURE" class="collapsed coll" href="#list{{this.duration_type}}">{{this.duration}}</a>
					<ul class="inner-list-view collapse" id="list{{this.duration_type}}">
						{{#each this.innerDuration}}
						<li>
							<a href="../{{../../marketplaceURl}}/search?{{DurationCalculator ../../queryURI ../this.duration_type this.value}}">
								<span>{{this.label}}</span>
							</a>
						</li>
						{{/each}}
					</ul>
				</li>
				{{/each}}
			</ul>
			{{/ifCond}}
		</div>
		<div class="col-md-9">
			{{#if topFeaturedProducts.count}}
			<div class="search-sm-header">
				<div class="alignleft">
					<span class="text-sm">
					{{#ifCond queryURI.is_featured_product "!=" 1}}
						<strong>TOP PRODUCTS &nbsp;|&nbsp;<a href="/{{marketplaceURl}}/search?{{QueryParams queryURI (FrameObject is_featured_product=1) 'null'}}">SEE ALL</a></strong>
					{{else}}
						<strong>ALL PRODUCTS &nbsp;|&nbsp;<a href="javascript:;" onclick="redirectBack()" >SEE ALL PRODUCTS</a></strong>
					{{/ifCond}}
					</span>

				</div>
				<div class="alignright">
					<small>Your product deserves to be on top
						<a href="/promote-store">Learn more about Top Ad feature.</a>
					</small>
				</div>
				<div style="clear: both;"></div>
			</div>
			{{#ifCond queryURI.is_featured_product "!=" 1}}
			<div class="search-list-body">
				<div class="row">
					{{!-- {{#ifCond topFeaturedProducts.count '==' 0}}
					<div class="col-md-12">
						<p class="text-primary text-center no-margins">No featured products available.</p>
					</div>
					{{/ifCond}}
 --}}					{{#ifCond layout_type "==" 'grid'}}
					{{#each topFeaturedProducts.rows}}
					<div class="col-md-4">
						<div class="product-body">
							<div class="table-responsive">
								<table class="table shoping-cart-table">
									<tbody>
										<tr class="d-flex">
											<td class="col-3">
												<div class="product-left-col">
													<img class="object-fit" src="{{this.product_base_image}}" alt="{{this.product_name}}" onError="imgError(this)" title="{{this.product_name}}">
												</div>
											</td>
											<td class="col-6">
												<div class="product-middle-col">
													<h3>
														<a href="/{{../marketplaceURl}}/{{this.product_slug}}/{{this.id}}" class="text-blue" title="{{this.product_name}}">{{#if ../marketPlaceTypeSelected}}{{../marketPlaceTypeSelected.code}} - {{/if}}{{this.product_name}}</a>
													</h3>
													<div class="row no-margins">
														<div class="col-md-4 col-4 no-padding">
															<span>Origin</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<span class="text-500">{{this.country_name}}</span>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Category</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<a class="text-500" href="{{../marketplaceURl}}/search?category={{this.category_id}}&sub_category={{this.sub_category_id}}" title="{{this.category_name}} > {{this.sub_category_name}}">{{this.category_name}} > {{this.sub_category_name}}</a>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Seller</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															{{#if ../LoggedInUser.email}}
															<a class="text-500" title="{{this.vendor_name}}" href="/vendor/{{this.vendor_id}}">{{this.vendor_name}}</a>
															{{else}}
															<a class="text-500" href="javascript:;" id="Seller_Info" title="seller">(Login for Seller Info)</a>
															{{/if}}
														</div>
													</div>
												</div>
											</td>
											<td class="col-3">
												<div class="product-right-col">
													{{#ifCond this.marketplace_id '==' 1}}
													<h4>MOQ : {{this.minimum_order_quantity}}</h4>
													{{/ifCond}} {{#ifCond this.marketplace_id '!=' 1}}
													<h2 class="text-red">${{this.product_price}}</h2>
													{{/ifCond}}
													<div class="prc-bottom">
														<p>Seller Rating</p>
														<div class="p-rating pull-right">
															{{starCount product_rating}}
														</div>
													</div>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					{{/each}}
					{{/ifCond}}

					{{#ifCond layout_type "==" "list"}}
					{{#each topFeaturedProducts.rows}}
					<div id="GR_list" class="table-responsive">
						<table class="table shoping-cart-table">
							<tbody>
								<tr class="d-flex">
									<td class="col-2">
										<div class="product-left-col">
											<img class="object-fit" src="{{this.product_base_image}}" alt="{{this.product_name}}" onError="imgError(this)" title="{{this.product_name}}">
										</div>
									</td>
									<td class="col-7">
										<div class="product-middle-col">
											<h3>
												<a href="/{{../marketplaceURl}}/{{this.product_slug}}/{{this.id}}" class="text-blue">{{#if ../marketPlaceTypeSelected}}{{../marketPlaceTypeSelected.code}} - {{/if}}{{this.product_name}}</a>
											</h3>

											<div class="row no-margins">
												<span>Origin&nbsp;:</span>
												<span class="text-500">&nbsp;{{this.country_name}}&nbsp;|&nbsp;</span>

												<span>Category&nbsp;</span>
												<a class="text-500" href="{{../marketplaceURl}}/search?category={{this.category_id}}&sub_category={{this.sub_category_id}}" title="{{this.category_name}} > {{this.sub_category_name}}">{{this.category_name}} > {{this.sub_category_name}}&nbsp;|&nbsp;</a>

												<span>Seller&nbsp;</span>
												{{#if ../LoggedInUser.email}}
												<a class="text-500" title="{{this.vendor_name}}" href="/vendor/{{this.vendor_id}}">{{this.vendor_name}}</a>
												{{else}}
												<a class="text-500" href="javascript:;" id="Seller_Info" title="seller">(Login for Seller Info)</a>
												{{/if}}
											</div>
										</div>

										<div class="row no-margins">
											<p class="description" >{{this.product_description}}</p>
										</div>
									</td>
									<td class="col-3">
										<div class="product-right-col">
											{{#ifCond this.marketplace_id '==' 1}}
											<h4>MOQ : {{this.minimum_order_quantity}}</h4>
											{{/ifCond}} {{#ifCond this.marketplace_id '!=' 1}}
											<h2 class="text-red">${{this.product_price}}</h2>
											{{/ifCond}}
											<div class="prc-bottom">
												<p>Seller Rating</p>
												<div class="p-rating pull-right">
													{{starCount product_rating}}
												</div>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					{{/each}}
					{{/ifCond}}
				</div>
			</div>
			
			
			<div class="search-xs-header"></div>
			{{/ifCond}}
			{{/if}}
			<div class="search-list-body">
			{{#if products.count}}
				<div class="row">
					{{#ifCond layout_type "==" "list"}}
					{{#each products.rows}}
					<div id="GR_list" class="table-responsive">
						<table class="table shoping-cart-table">
							<tbody>
								<tr class="d-flex">
									<td class="col-2">
										<div class="product-left-col">
											<img class="object-fit" src="{{this.product_base_image}}" alt="{{this.product_name}}" onError="imgError(this)" title="{{this.product_name}}">
										</div>
									</td>
									<td class="col-7">
										<div class="product-middle-col">
											<h3>
												<a href="/{{../marketplaceURl}}/{{this.product_slug}}/{{this.id}}" class="text-blue">{{#if ../marketPlaceTypeSelected}}{{../marketPlaceTypeSelected.code}} - {{/if}}{{this.product_name}}</a>
											</h3>

											<div class="row no-margins">
												<span>Origin&nbsp;:</span>
												<span class="text-500">&nbsp;{{this.country_name}}&nbsp;|&nbsp;</span>

												<span>Category&nbsp;</span>
												<a class="text-500" href="{{../marketplaceURl}}/search?category={{this.category_id}}&sub_category={{this.sub_category_id}}" title="{{this.category_name}} > {{this.sub_category_name}}">{{this.category_name}} > {{this.sub_category_name}}&nbsp;|&nbsp;</a>

												<span>Seller&nbsp;</span>
												{{#if ../LoggedInUser.email}}
												<a class="text-500" title="{{this.vendor_name}}" href="/vendor/{{this.vendor_id}}">{{this.vendor_name}}</a>
												{{else}}
												<a class="text-500" href="javascript:;" id="Seller_Info" title="seller">(Login for Seller Info)</a>
												{{/if}}
											</div>
										</div>
										<div class="row no-margins">
											<p class="description">{{this.product_description}}</p>
										</div>
									</td>
									<td class="col-3">
										<div class="product-right-col">
											{{#ifCond this.marketplace_id '==' 1}}
											<h4>MOQ : {{this.minimum_order_quantity}}</h4>
											{{/ifCond}} {{#ifCond this.marketplace_id '!=' 1}}
											<h2 class="text-red">${{this.product_price}}</h2>
											{{/ifCond}}
											<div class="prc-bottom">
												<p>Seller Rating</p>
												<div class="p-rating pull-right">
													{{starCount product_rating}}
												</div>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					{{/each}}
					{{/ifCond}}

					{{#ifCond layout_type "==" "grid"}}
					{{#each products.rows}}
					<div class="col-md-4">
						<div class="product-body">
							<div id="GR_grid" class="table-responsive">
								<table class="table shoping-cart-table">
									<tbody>
										<tr class="d-flex">
											<td class="col-2">
												<div class="product-left-col">
													<img class="object-fit" src="{{this.product_base_image}}" alt="{{this.product_name}}" onError="imgError(this)" title="{{this.product_name}}">
												</div>
											</td>
											<td class="col-7">
												<div class="product-middle-col">
													<h3>
														<a href="/{{../marketplaceURl}}/{{this.product_slug}}/{{this.id}}" class="text-black" title="{{this.product_name}}">{{#if ../marketPlaceTypeSelected}}{{../marketPlaceTypeSelected.code}} - {{/if}}{{this.product_name}}</a>
													</h3>
													<div class="row no-margins">
														<div class="col-md-4 col-4 no-padding">
															<span>Origin</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<span class="text-500">{{this.country_name}}</span>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Category</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															<a class="text-500" href="{{../marketplaceURl}}/search?category={{this.category_id}}&sub_category={{this.sub_category_id}}" title="{{this.category_name}} > {{this.sub_category_name}}">{{this.category_name}} > {{this.sub_category_name}}</a>
														</div>
														<div class="col-md-4 col-4 no-padding">
															<span>Seller</span>
														</div>
														<div class="col-md-8 col-8 no-padding overflow-txt">
															{{#if ../LoggedInUser.email}}
															<a class="text-500" title="{{this.vendor_name}}" href="/vendor/{{this.vendor_id}}">{{this.vendor_name}}</a>
															{{else}}
															<a class="text-500" href="javascript:;" id="Seller_Info" title="seller">(Login for Seller Info)</a>
															{{/if}}
														</div>
													</div>
												</div>
											</td>
											<td class="col-3">
												<div class="product-right-col">
													{{#ifCond this.marketplace_id '==' 1}}
													<h4>MOQ : {{this.minimum_order_quantity}}</h4>
													{{/ifCond}}
													{{#ifCond this.marketplace_id '!=' 1}}
													<h2 class="text-red">${{this.product_price}}</h2>
													{{/ifCond}}
													<div class="prc-bottom">
														<p>Seller Rating</p>
														<div class="p-rating pull-right">
															{{starCount product_rating}}
														</div>
													</div>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					{{/each}}
					{{/ifCond}}
				</div>
			{{else}}
			<p class="text-primary text-center no-margins">No products available.</p>
			{{/if}}
			</div>
			{{#if products.count }}
			<div class="search-sm-header"><br></div>
			{{/if}}
			{{#ifCond products.count '>' queryPaginationObj.limit}}
			<div class="row m-t-sm">
				<div class="col-md-12">
					{{#pagination products.count queryPaginationObj.page queryPaginationObj.limit queryPaginationObj.maxSize}}
					<nav aria-label="Page navigation example">
						<ul class="pagination justify-content-center">
							{{#unless startFromFirstPage}}
							<li class="page-item">
								<a class="page-link" href="../{{../../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=(DiffFloat ../queryPaginationObj.page 1) limit=../queryPaginationObj.limit) 'null'}}">Previous</a>
							</li>
							{{/unless}}

							{{#each pages}}
							<li class="page-item {{#if isCurrent}} active {{/if}}">
								<a class="page-link" href="../{{../../marketplaceURl}}/search?{{QueryParams ../../queryURI (FrameObject page=page limit=../../queryPaginationObj.limit) 'null'}}">{{page}}</a>
							</li>
							{{/each}}

							{{#unless endAtLastPage}}
							<li class="page-item">
								<a class="page-link" href="../{{../../marketplaceURl}}/search?{{QueryParams ../queryURI (FrameObject page=(SUMFloat ../queryPaginationObj.page 1) limit=../queryPaginationObj.limit) 'null'}}">Next</a>
							</li>
							{{/unless}}

						</ul>
					</nav>
					{{/pagination}}
				</div>
			</div>
			{{/ifCond}}
		</div>
	</div>
</div>
{{> footer/bottom-footer}}
