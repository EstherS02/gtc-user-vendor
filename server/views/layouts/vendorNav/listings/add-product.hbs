<style>
    .imageThumb {
        height: 150px;
        width: 150px;
        border: 2px solid;
        padding: 1px;
        cursor: pointer;
    }

    .pip {
        display: inline-block;
        margin: 10px 10px 0 0;
    }

    .imgBlock {
        display: block;
        width: 150px;
        background: #444;
        border: 1px solid black;
        color: white;
        text-align: center;
        cursor: pointer;
    }

    .imgBlock:hover {
        background: white;
        color: black;
    }
</style>
<script>
    function addProduct(obj, input) {
        $.ajax({
            type: 'POST',
            url: '/api/product/add-product?' + input,
            data: obj,
            success: function (data) {

                $('#gtc-add-to-cart').prop('disabled', false);
                $('#gtc-cart-alert').removeClass('alert-danger').addClass('alert-success');
                $('#gtc-cart-alert .cart-message').text("Product Added Successfully")
                $("#gtc-cart-alert").fadeTo(7000, 500).slideUp(500, function () {
                    $("#gtc-cart-alert").slideUp(500);
                });
                $("#productForm")[0].reset();
            },
            error: function (error) {
                $('#gtc-add-to-cart').prop('disabled', false);
                $('#gtc-cart-alert').removeClass('alert-success').addClass('alert-danger');
                $('#gtc-cart-alert .cart-message').text("Server Error")
                $("#gtc-cart-alert").fadeTo(7000, 500).slideUp(500, function () {
                    $("#gtc-cart-alert").slideUp(500);
                });
                $("#productForm")[0].reset();
            }
        })
    }
    $(document).ready(function () {
        $("#gtc-cart-alert").hide();

        /* if (window.File && window.FileList && window.FileReader) {*/
        $("#files").on("change", function (e) {
            var files = e.target.files,
                filesLength = files.length;

            if (filesLength < 5) {

                for (var i = 0; i < filesLength; i++) {
                    var f = files[i]
                    var fileReader = new FileReader();
                    fileReader.onload = (function (e) {
                        var file = e.target;
                        $("<span class=\"pip\">" +
                            "<img class=\"imageThumb\" src=\"" + e.target.result + "\" title=\"" + file.name + "\"/>" +
                            "<br/><span class=\"imgBlock\"><i class='fas fa-crop float-left'></i><input type='radio' name='base_image'>Base Image<i class='fa fa-times float-right' id=\"remove\" aria-hidden='true'></i></span>" +
                            "</span>").insertAfter(".preview");
                        $("#remove").click(function () {
                            $(this).parents(".pip").remove();
                        });

                    });
                    fileReader.readAsDataURL(f);
                }
            }
            else {
                alert("Maximum you can upload 4 images for a product")
            }
        });
        /*} else {
          alert("Your browser doesn't support to File API")
        }*/

        $("#country").change(function () {
            var country_id = $('#country').val();

            $.ajax({
                url: '/api/states?country_id=' + country_id,
                type: 'GET',
                success: function (result) {
                    $("#state").empty();
                    for (var i = 0; i < result.rows.length; i++) {
                        var options;
                        options = "<option value=" + result.rows[i].id + ">" + result.rows[i].name + "</option>";
                        $("#state").append(options)
                    }
                },
                error: function (error) {
                    console.log("Error", error);
                }
            });
        });

        $("#category").change(function () {
            var category_id = $('#category').val();

            $.ajax({
                url: '/api/sub-categories?category_id=' + category_id,
                type: 'GET',
                success: function (result) {
                    $("#sub_category").empty();
                    for (var i = 0; i < result.rows.length; i++) {
                        var options;
                        options = "<option value=" + result.rows[i].id + ">" + result.rows[i].name + "</option>";
                        $("#sub_category").append(options)
                    }
                },
                error: function (error) {
                    console.log("Error", error);
                }
            });
        });

        $("#productForm").submit(function (e) {
            e.preventDefault();

            let input = $("#productForm :input").filter(function (index, element) {
                return $(element).val() != '';
            }).serialize();

            if ($("#files")[0].files.length > 0) {
                var form = new FormData();

                  $.each($("#files")[0].files, function (i, file) {
                      form.append("file[" + i + "]", file);
                  });

                $.ajax({
                    type: 'POST',
                    url: '/api/prod/multiple',
                    data: form,
                    cache: false,
                    dataType: 'json',
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        var imageURLs= data.imageURLs;
                        var imageURLsArr = [],i=0;
                        
                        imageURLs.forEach(function (element) {
                        var imageURLobj={};
 
                        imageURLobj.status=1;
                        imageURLobj.type=1;                       
                        imageURLobj.url= imageURLs[i];
                        
                        imageURLsArr.push(imageURLobj);
                        i++;
                        });

                        var dataFormate = {};
		                dataFormate.data = JSON.stringify(imageURLsArr);

                        addProduct(dataFormate, input);
                    },
                    error: function (error) {
                        console.log('error', error);
                    }
                });
            } else {
                var obj = {};
                obj.url = null;
                addProduct(obj, input);
            }
        });
    });
</script>
<div class="modal fade" id="profile-picture-modal" tabindex="-1" role="dialog" aria-labelledby="profile-picture-modalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="profile-picture-modalLabel">Crop Profile Avatar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="margin-right:35px">
                <div class="container">
                    <img src="" style="max-width: 100% !important;" id="uploaded-profile-picture" alt="Profile Picture">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="crop-profile-image">Crop Image</button>
            </div>
        </div>
    </div>
</div>
{{> header/top-header LoggedInUser = LoggedInUser}}{{> vendor/vendor-menu}}

<div class="wrapper-content bg-gray">
    <div class="gtc-container">
        <div class="row">
            <div class="col-sm-2">
                {{> vendor/vendor-side-navbar}}
            </div>
            <div class="col-sm-10">
                <div class="ibox">
                    <div class="ibox-content">
                        <div class="ibox-title">
                            <h2>Add Product</h2>
                            <div class="alert" id="gtc-cart-alert">
                                <button type="button" class="close" data-dismiss="alert">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <span class="cart-message"></span>
                            </div>
                        </div>
                        <div class="content-body">
                            <form id="productForm" class="form">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="label-control">Product Name
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control-customized form-control-sm" name="product_name">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Marketplace
                                                <span class="text-danger">*</span>
                                            </label>
                                            {{#ifCond this.type '==' 'wholesale'}}
                                            <input type="text" class="form-control-customized form-control-sm" name="marketplace" value="Private Wholesale Marketplace"
                                                readonly> {{else ifCond this.type '==' 'shop'}}
                                            <input type="text" class="form-control-customized form-control-sm" name="marketplace" value="Public Marketplace" readonly> {{else ifCond this.type '==' 'services'}}
                                            <input type="text" class="form-control-customized form-control-sm" name="marketplace" value="Services Marketplace" readonly> {{else ifCond this.type '==' 'subscription'}}
                                            <input type="text" class="form-control-customized form-control-sm" name="marketplace" value="Lifestyle Marketplace" readonly> {{/ifCond}}
                                        </div>
                                    </div>
                                    {{#ifCond this.type '==' 'wholesale'}}
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Type
                                                <span class="text-danger">*</span>
                                            </label>
                                            <select class="custom-select form-control-customized form-control-sm custom_left_arrow_style" name="marketplace_type_id"
                                                required>
                                                <option disabled selected>Select Category...</option>
                                                {{#each marketplaceType}}
                                                <option value="{{this.id}}">{{ Titlecase this.name}}</option>
                                                {{/each}}
                                            </select>
                                        </div>
                                    </div>
                                    {{/ifCond}}
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Shipping Cost
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control-customized form-control-sm" name="shipping_cost">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="label-control">Category
                                                <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <select class="custom-select form-control-customized form-control-sm custom_left_arrow_style" name="product_category_id"
                                                    id="category" required>
                                                    <option disabled selected>Select Category...</option>
                                                    {{#each categories}}
                                                    <option value="{{this.id}}">{{ Titlecase this.name}}</option>
                                                    {{/each}}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="label-control">Sub Category
                                                <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <select class="custom-select form-control-customized form-control-sm custom_left_arrow_style" name="sub_category_id" id="sub_category">
                                                    <option disabled selected>Select Sub Category...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Country
                                                <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <select class="custom-select form-control-customized form-control-sm custom_left_arrow_style" name="product_location" id="country"
                                                    required>
                                                    <option disabled selected>Select Country...</option>
                                                    {{#each country}}
                                                    <option value="{{this.id}}">{{ this.name}}</option>
                                                    {{/each}}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">State
                                                <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <select class="custom-select form-control-customized form-control-sm custom_left_arrow_style" name="state_id" id="state"
                                                    value="" required>
                                                    <option disabled selected>Select State...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">City
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control-customized form-control-sm" name="city">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">SKU
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control-customized form-control-sm" placeholder="Stock keep unit" name="sku">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Price
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" name="price" class="form-control-customized form-control-sm">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="label-control">Quantity Available
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" name="quantity_available" class="form-control-customized form-control-sm">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="label-control">Description</label>
                                            <textarea class="form-control-customized" name="description" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="form-group">
                                            <label class="label-control">Upload Image
                                                <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <div class="custom-file">
                                                    <input type="file" class="custom-file-input" id="files" name="files[]" multiple>
                                                    <label class="custom-file-label customized-file-label" for="files">Choose file</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="preview"></div>
                                    </div>
                                </div>
                                <br/>

                                <div class="row">
                                    <div class="col-lg-12">
                                        <button type="submit" class="btn btn-primary btn-sm">Submit</button>
                                        <button type="reset" class="btn btn-gray btn-sm">Cancel</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{> footer/bottom-footer}}