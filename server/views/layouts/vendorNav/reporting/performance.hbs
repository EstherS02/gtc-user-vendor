<script>
	$(function() {
		$("#lhs_from").datepicker({
			trigger: $("#lhs_fromRange"),
			autoHide: true
		});
		$("#lhs_to").datepicker({
			trigger: $("#lhs_toRange"),
			autoHide: true
		});
		$("#rhs_from").datepicker({
			trigger: $("#rhs_fromRange"),
			autoHide: true
		});
		$("#rhs_to").datepicker({
			trigger: $("#rhs_toRange"),
			autoHide: true
		});
	});
</script>

<script type="text/javascript">
	var userInfo = {{{ DisplayJSON LoggedInUser }}}
	var params = {{{ DisplayJSON queryURIString }}};
	var metrics = {{{ DisplayJSON selectedMetrics }}};
	function downloadCSV(args) {
		if (metrics == 'products') {
			$.ajax({
				type: 'POST',
				url: '/api/export-csv/reportperformancecsv',
				data: { "vendor_id": $('#login_vendoruserid').val() },
				success: function(data) {
					var csvData = new Blob([data], { type: 'text/csv;charset=utf-8;' });
					var csvURL = null;
					if (navigator.msSaveBlob) {
						csvURL = navigator.msSaveBlob(csvData, 'Report.csv');
					} else {
						csvURL = window.URL.createObjectURL(csvData);
					}
					var tempLink = document.createElement('a');
					tempLink.href = csvURL;
					tempLink.setAttribute('download', 'Report.csv');
					tempLink.click();
				},
				error: function(request, status, error) {
					console.log('request', request);
					console.log('status', status);
				}
			});
		} else if (metrics == 'marketplace') {
			$.ajax({
				type: 'POST',
				url: '/api/export-csv/reportmarketplacecsv',
				data: { "vendor_id": $('#login_vendoruserid').val() },
				success: function(data) {
					var csvData = new Blob([data], { type: 'text/csv;charset=utf-8;' });
					var csvURL = null;
					if (navigator.msSaveBlob) {
						csvURL = navigator.msSaveBlob(csvData, 'Report.csv');
					} else {
						csvURL = window.URL.createObjectURL(csvData);
					}
					var tempLink = document.createElement('a');
					tempLink.href = csvURL;
					tempLink.setAttribute('download', 'Report.csv');
					tempLink.click();
				},
				error: function(request, status, error) {
					console.log('request', request);
					console.log('status', status);
				}
			});
		} else if (metrics == 'city') {
			$.ajax({
				type: 'POST',
				url: '/api/export-csv/reportcitycsv',
				data: { "vendor_id": $('#login_vendoruserid').val() },
				success: function(data) {
					var csvData = new Blob([data], { type: 'text/csv;charset=utf-8;' });
					var csvURL = null;
					if (navigator.msSaveBlob) {
						csvURL = navigator.msSaveBlob(csvData, 'Report.csv');
					} else {
						csvURL = window.URL.createObjectURL(csvData);
					}
					var tempLink = document.createElement('a');
					tempLink.href = csvURL;
					tempLink.setAttribute('download', 'Report.csv');
					tempLink.click();
				},
				error: function(request, status, error) {
					console.log('request', request);
					console.log('status', status);
				}
			});
		}
	}

	function limit(size) {
		params = replaceUrlParam(params, "limit", size);
		params = replaceUrlParam(params, "page", 1);
		params = replaceUrlParam(params, "offset", 0);
		location.href = "/store/performance?" + params;
	}

	function replaceUrlParam(existingQueryParams, paramsName, paramsValue) {
		var urlParams = new URLSearchParams(existingQueryParams);
		if (paramsValue) {
			urlParams.set(paramsName, paramsValue);
		} else {
			urlParams.delete(paramsName);
		}
		return urlParams;
	}

	function onSearch() {
		var metric;
		var from = $('#lhs_from').val();
		var to = $('#lhs_to').val();
		var Cfrom = $('#rhs_from').val();
		var Cto = $('#rhs_to').val();
		Compare = $('#compare').is(":checked");

		if ($("#inputTop").val() == 1) {
			metric = "products";
		} else if ($("#inputTop").val() == 2) {
			metric = "marketplace"
		} else if ($("#inputTop").val() == 3) {
			metric = "city"
		}

		location.href = "/store/performance?top=" + metric + "&lhs_from=" + from + "&lhs_to=" + to + "&rhs_from=" + Cfrom + "&rhs_to=" + Cto + "&compare=" + Compare;
	}

</script> {{> header/top-header LoggedInUser = LoggedInUser}} {{> vendor/vendor-menu}}
<div class="wrapper-content bg-gray">
	<div class="gtc-container">
		<div class="row">
			<div class="col-sm-2">
				{{> vendor/vendor-side-navbar}}
			</div>
			{{#if LoggedInUser.Vendor.VendorPlans}}
				<div class="col-sm-10">
					<div class="ibox">
						<div class="ibox-content">
							<div class="ibox-title">
								<h2>Performance
									<span class="pull-right" style="font-size:12px"><a href="/store/performance">Clear All</a></span>
								</h2>
							</div>
							<div class="content-body">
								<div class="row">
									<div class="col-md-12">
										<form class="form-inline pull-left m-t-md">
											<div class="form-group">
												<label class="label-control" style="padding: 5px;">Date Range </label>
											</div>
											<div class="form-group">
												<div class="input-group mgT-5">
													<input id="lhs_from" style="width:89px;height: 25px;" type="text" class="custom-form-control date_range_picker no-padding"
													 value="{{queryURI.lhs_from}}" placeholder="MM/DD/YYYY" aria-label="lhs_fromRange" aria-describedby="lhs_fromRange">
													<div class="input-group-append cursor-pointer">
														<span class="input-group-text pad-3" id="lhs_fromRange">
															<img class="calendar-icon" src="../../img/calendar.png">
														</span>
													</div>
												</div>
											</div>
											<div class="form-group">
												<label class="label-control">to </label>
											</div>
											<div class="form-group">
												<div class="input-group mgT-5">
													<input id="lhs_to" style="width:89px;height: 25px;" type="text" class="custom-form-control date_range_picker no-padding"
													 value="{{queryURI.lhs_to}}" placeholder="MM/DD/YYYY" aria-label="lhs_toRange" aria-describedby="lhs_toRange">
													<div class="input-group-append cursor-pointer">
														<span class="input-group-text pad-3" id="lhs_toRange">
															<img class="calendar-icon" src="../../img/calendar.png">
														</span>
													</div>
												</div>
											</div>
											<div class="form-group mgT-5">
												<div class="select-container">
													<select id="inputDateRange" style="width:100px;padding:3px;height: 25px;" class="form-control-customized form-control-sm custom-dropdown"
													 name="countyr">
														<option value="0">LAST 30 DAY</option>
													</select>
												</div>
											</div>
											<div class="form-group mgT-5">
												<div class="customCheckbox" style="margin-left: 30px;">
													<input type="checkbox" checked='checked' id="compare" value="true" class="customCheckboxInput">
													<label class="checkbox-b" for="compare"></label>
												</div>
											</div>
											<div class="form-group">
												<label class="label-control">compare to </label>
											</div>
											<div class="form-group">
												<div class="input-group mgT-5">
													<input id="rhs_from" style="width:89px;height: 25px;" type="text" class="custom-form-control date_range_picker no-padding"
													 value="{{queryURI.lhs_from}}" placeholder="MM/DD/YYYY" aria-label="rhs_fromRange" aria-describedby="rhs_fromRange">
													<div class="input-group-append cursor-pointer">
														<span class="input-group-text pad-3" id="rhs_fromRange">
															<img class="calendar-icon" src="../../img/calendar.png">
														</span>
													</div>
												</div>
											</div>
											<div class="form-group">
												<label class="label-control">to </label>
											</div>
											<div class="form-group">
												<div class="input-group mgT-5">
													<input id="rhs_to" style="width:89px;height: 25px;" type="text" class="custom-form-control date_range_picker no-padding"
													 value="{{queryURI.rhs_to}}" placeholder="MM/DD/YYYY" aria-label="rhs_toRange" aria-describedby="rhs_toRange">
													<div class="input-group-append cursor-pointer">
														<span class="input-group-text pad-3" id="rhs_toRange">
															<img class="calendar-icon" src="../../img/calendar.png">
														</span>
													</div>
												</div>
											</div>
											<div class="form-group">
												<button type="button" class="update-btn1 report_update report_update_btn_override" style="color:#fff;background-color:#3bb802;margin-left:5px"
												 onclick="onSearch()">UPDATE</button>
											</div>
										</form>
										<form class="form-inline pull-right m-t-md">
											<div class="form-group m-r">
												{{#if topItems.lhs_result}}
													<button type="button" class="btn btn-md btn-muted" onclick='downloadCSV({ filename: "stock-data.csv" });'>EXPORT</button>
													<input type="hidden" name="user_id" id="login_vendoruserid" value= {{LoggedInUser.Vendor.id}}>
												{{else}}
													<button type="button" class="btn btn-md btn-muted" disabled='disabled' onclick='downloadCSV({ filename: "stock-data.csv" });'>EXPORT</button>
													<input type="hidden" name="user_id" id="login_vendoruserid" value= {{LoggedInUser.Vendor.id}}>
												{{/if}}
											</div>
										</form>
									</div>
								</div>
								<br>
								<div class="row" style="padding: 5px;">
									<div class="col-md-2">
										<p style="font-size:13px;margin-top:3px">Select a metric</p>
									</div>
									<div class="col-md-7">
										<div class="form-group" style="width:273px;margin-left:-63px;">
											<div class="select-container">
												<select id="inputTop" style="height:25px;" onchange="onSearch()" class="form-control-customized form-control-sm custom-dropdown"
												 name="countyr">
													<option value="1" {{#ifCond queryURI.top "==" 'products'}} selected="true" {{/ifCond}}>TOP SELLING PRODUCTS</option>
													<option value="2" {{#ifCond queryURI.top "==" 'countries'}} selected="true" {{/ifCond}}>TOP SELLING COUNTRIES</option>
													<option value="3" {{#ifCond queryURI.top "==" 'cities'}} selected="true" {{/ifCond}}>TOP PERFORMING CITIES</option>
													<option value="4" {{#ifCond queryURI.top "==" 'buyers'}} selected="true" {{/ifCond}}>TOP BUYERS</option>
													{{!-- <option value="2" {{#ifCond queryURI.top "==" 'marketplace'}} selected="true" {{/ifCond}}>TOP PERFORMING MARKETPLACES</option> --}}
													
												</select>
											</div>
										</div>
									</div>
									<div class="col-md-3 float-right" style="padding-left: 52px;">
										<div class="form-group">
											<div class="input-group gtc-rounded">
												<input type="text" placeholder="Search Products#" class="form-control form-control-sm">
												<button type="submit" class="btn btn-sm btn-gtc">
													<i class="fa fa-search"></i>
												</button>
											</div>
										</div>

									</div>
								</div>
								<div class="row">
									<div class="col-md-6">
									</div>
									<div class="col-md-6">
										<p class="vend_edit_lists_pstyle float-right">Entries per page:
											<a {{#ifCond queryURI.limit '==' 10}} class="active" {{/ifCond}} onclick="limit(10)" href="javascript:;">10</a>
											<a {{#ifCond queryURI.limit '==' 25}} class="active" {{/ifCond}} onclick="limit(25)" href="javascript:;">25</a>
											<a {{#ifCond queryURI.limit '==' 100}} class="active" {{/ifCond}} onclick="limit(100)" href="javascript:;">100</a>
											<a {{#ifCond queryURI.limit '==' 10000000000000}} class="active" {{/ifCond}} onclick="limit(10000000000000)" href="javascript:;">All</a>
										</p>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<table class="table order-table">
											{{#ifCond queryURI.top "==" "products"}}
												<thead>
													<tr>
														<th>
															<div class="customCheckbox">
																<input type="checkbox" onclick="selectAll(this);" id="inputCheckbox" class="customCheckboxInput">
																<label class="checkbox-b" for="inputCheckbox"></label>
															</div>
														</th>
														
													</tr>
												</thead>
											{{/ifCond}}
										</table>
									</div>
								</div>
								{{#ifCond queryURI.top "==" "products"}}
									<div class="row">
										<table class="table table-hover">
											<thead>
												<tr>
													<th>Product</th>
													<th>Type</th>
													<th>Sales</th>
													<th>Vendor Revenue</th>
													<th>GTC Processing Fees</th>

												</tr>
											</thead>
											<tbody>
												{{#each topItems.lhs_result}}
													<tr>
														<td>
															<img src="../..{{this.product_url}}" style="width: 15px;" />
															<a href="javascript:;" class="text_blue_color">
																<span class="d-inline-block text-truncate" style="max-width: 330px;">
																	{{this.product_name}}
																</span>
															</a>
														</td>
														<td>{{this.marketplace_name}}</td>
														{{compareSalePerformance this @root.performance.rhs_result}}
													</tr>
												{{/each}}
											</tbody>
										</table>
									</div>
								{{/ifCond}}
								{{!-- {{#ifCond queryURI.top "==" "marketplace"}}
									<div class="row">
										<table class="table table-hover">
											<thead>
												<tr>
													<th>Marketplace Name</th>
													<th>Sales</th>
													<th>Revenue</th>
													<th>Gtc Fees</th>
													<th>Vendor Revenue</th>
												</tr>
											</thead>
											<tbody>
												{{#each topItems.lhs_result}}
													<tr>
														<td>
															<img src="../..{{this.product_url}}" style="width: 15px;" />
															<a href="javascript:;" class="text_blue_color">
																<span class="d-inline-block text-truncate" style="max-width: 330px;">
																	{{this.product_name}}
																</span>
															</a>
														</td>
														<td>{{this.marketplace_name}}</td>
														{{compareSalePerformance this @root.performance.rhs_result}}
													</tr>
												{{/each}}
											</tbody>
										</table>
									</div>
								{{/ifCond}} --}}
								{{#ifCond queryURI.top "==" "city"}}
									<div class="row">
										<table class="table table-hover">
											<thead>
												<tr>
													<th>City Name</th>
													<th>Sales</th>
													<th>Revenue</th>
													<th>Gtc Fees</th>
													<th>Vendor Revenue</th>
												</tr>
											</thead>
											<tbody>
												{{#each topItems.lhs_result}}
													<tr>
														<td>
															<img src="../..{{this.product_url}}" style="width: 15px;" />
															<a href="javascript:;" class="text_blue_color">
																<span class="d-inline-block text-truncate" style="max-width: 330px;">
																	{{this.product_name}}
																</span>
															</a>
														</td>
														<td>{{this.marketplace_name}}</td>
														{{compareSalePerformance this @root.performance.rhs_result}}
													</tr>
												{{/each}}
											</tbody>
										</table>
									</div>
								{{/ifCond}}
								{{!-- <div class="row">
									<div class="col-md-6">
									</div>
									<div class="col-md-6">
										<p class="vend_edit_lists_pstyle float-right">Entries per page:
											<a {{#ifCond queryURI.limit '==' 10}} class="active" {{/ifCond}} onclick="limit(10)" href="javascript:;">10</a>
											<a {{#ifCond queryURI.limit '==' 25}} class="active" {{/ifCond}} onclick="limit(25)" href="javascript:;">25</a>
											<a {{#ifCond queryURI.limit '==' 100}} class="active" {{/ifCond}} onclick="limit(100)" href="javascript:;">100</a>
											<a {{#ifCond queryURI.limit '==' 10000000000000}} class="active" {{/ifCond}} onclick="limit(10000000000000)" href="javascript:;">All</a>
										</p>
									</div>
								</div> --}}
							</div>
						</div>
					</div>
				</div>
			{{else}}
				{{> plan-inactive}}
			{{/if}}
		</div>
	</div>
</div>
{{> footer/bottom-footer}}